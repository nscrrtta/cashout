<style>
  .column {
    float: left;
    width: 80px;
  }

  .row:after {
    content: "";
    display: table;
    clear: both;
  }

  input {
    width: 80px;
  }
</style>

<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Cash Out</title>
  </head>
  <body>
    <form>
      <div class="row">
        <div class="column">
          <label for="amount">Amount:</label><br><br>
        </div>
        <div class="column">
          <input type="number" id="amount" name="amount" step="0.01" value="0"><br><br>
        </div>
      </div>

      <div class="row">
        <div class="column">
          <label for="nickels">Nickels:</label><br>
        </div>
        <div class="column">
          <input type="number" id="nickels" name="nickels" step="1"  min="0" value="0"><br>
        </div>
      </div>

      <div class="row">
        <div class="column">
          <label for="dimes">Dimes:</label><br>
        </div>
        <div class="column">
          <input type="number" id="dimes" name="dimes" step="1"  min="0" value="0"><br>
        </div>
      </div>

      <div class="row">
        <div class="column">
          <label for="quarters">Quarters:</label><br>
        </div>
        <div class="column">
          <input type="number" id="quarters" name="quarters" step="1"  min="0" value="0"><br>
        </div>
      </div>

      <div class="row">
        <div class="column">
          <label for="loonies">Loonies:</label><br>
        </div>
        <div class="column">
          <input type="number" id="loonies" name="loonies" step="1"  min="0" value="0"><br>
        </div>
      </div>

      <div class="row">
        <div class="column">
          <label for="toonies">Toonies:</label><br><br>
        </div>
        <div class="column">
          <input type="number" id="toonies" name="toonies" step="1"  min="0" value="0"><br><br>
        </div>
      </div>

      <div class="row">
        <div class="column">
          <label for="fives">Fives:</label><br>
        </div>
        <div class="column">
          <input type="number" id="fives" name="fives" step="1"  min="0" value="0"><br>
        </div>
      </div>

      <div class="row">
        <div class="column">
          <label for="tens">Tens:</label><br>
        </div>
        <div class="column">
          <input type="number" id="tens" name="tens" step="1"  min="0" value="0"><br>
        </div>
      </div>

      <div class="row">
        <div class="column">
          <label for="twenties">Twenties:</label><br>
        </div>
        <div class="column">
          <input type="number" id="twenties" name="twenties" step="1"  min="0" value="0"><br>
        </div>
      </div>

      <div class="row">
        <div class="column">
          <label for="fifties">Fifties:</label><br>
        </div>
        <div class="column">
          <input type="number" id="fifties" name="fifties" step="1"  min="0" value="0"><br>
        </div>
      </div>

      <div class="row">
        <div class="column">
          <label for="hundreds">Hundreds:</label><br><br>
        </div>
        <div class="column">
          <input type="number" id="hundreds" name="hundreds" step="1"  min="0" value="0"><br><br>
        </div>
      </div>

      <div class="row">
        <div class="column">
          <button onclick="calculate()">Calculate</button>
        </div>
        <div class="column">
          <button onclick="clearInput()">Clear</button>
        </div>
      </div>
    </form>

    <p id="result"></p>

    <script>
      const coinNames = [
        // Change
        "nickels",
        "dimes",
        "quarters",
        "loonies",
        "toonies",

        // Bills
        "fives",
        "tens",
        "twenties",
        "fifties",
        "hundreds"
      ];

      const coinValues = [
        // Change
        0.05,
        0.10,
        0.25,
        1.00,
        2.00,

        // Bills
          5,
         10,
         20,
         50,
        100
      ];

      const cashBag = {
        // Change
        0.05: 0,
        0.10: 0,
        0.25: 0,
        1.00: 0,
        2.00: 0,

        // Bills
          5: 0,
         10: 0,
         20: 0,
         50: 0,
        100: 0
      };

      const takeHome = {
        // Change
        0.05: 0,
        0.10: 0,
        0.25: 0,
        1.00: 0,
        2.00: 0,

        // Bills
          5: 0,
         10: 0,
         20: 0,
         50: 0,
        100: 0
      };

      let amount = remaining = 0;

      onLoad();

      function onLoad(){
        amount = localStorage.getItem("amount");
        if (!amount) amount = 0;
        
        let amountElement = document.getElementById("amount");
        amountElement.value = amount;

        let input = localStorage.getItem("input");
        if (input){
          input = JSON.parse(input);

          for (let i = 0; i < coinNames.length; i++){
            const coinName  = coinNames [i];
            const coinValue = coinValues[i];

            let element = document.getElementById(coinName);
            element.value = input[coinValue];
          }
        }

        let result = localStorage.getItem("result");
        if (!result) result = ``;

        let resultElement = document.getElementById("result");
        resultElement.innerHTML = result;
      }

      function putInBag(){
        for (let i = 0; i < coinValues.length; i++) {
          const coinValue = coinValues[i];
          const quantity  = takeHome[coinValue];

          for (let q = 0; q < quantity; q++){
            if (remaining < 0) break;
            remaining = Math.round((remaining - coinValue) * 100) / 100;

            cashBag [coinValue] += 1;
            takeHome[coinValue] -= 1;
          }
        }
      }

      function takeFromBag(){
        for (let i = coinValues.length - 1; i >= 0; i--) {
          const coinValue = coinValues[i];
          const quantity  = cashBag[coinValue];

          for (let q = 0; q < quantity; q++){
            if (-remaining < coinValue) break;
            remaining = Math.round((remaining + coinValue) * 100) / 100;

            cashBag [coinValue] -= 1;
            takeHome[coinValue] += 1;
          }
        }
      }

      function getSum(bag){
        let sum = 0;

        for (coinValue in bag) {
          const quantity = bag[coinValue];
          sum += coinValue * quantity;
        }

        return Math.round(sum * 100) / 100;
      }
      
      function parseInput(){
        amount = parseFloat(document.getElementById("amount").value);
        if (isNaN(amount)) amount = 0;

        remaining = amount;

        for (let i = 0; i < coinNames.length; i++){
          const coinName  = coinNames [i];
          const coinValue = coinValues[i];

          let quantity = parseInt(document.getElementById(coinName).value);
          if (isNaN(quantity)) quantity = 0;

          takeHome[coinValue] = quantity;
        }

        localStorage.setItem("amount", amount);
        localStorage.setItem("input", JSON.stringify(takeHome));
      }

      function calculate(){
        parseInput();
        const total = getSum(takeHome);

        putInBag();
        if (remaining < 0) takeFromBag();

        displayResult(total);
      }

      function displayResult(total){
        let result = `TOTAL: $${total.toFixed(2)}<br><br>`;

        if (remaining > 0){
          result += `There is not enough money in your cash bag to make $${amount.toFixed(2)}`;
          result += `<br>You need $${remaining.toFixed(2)}`;
        }else{
          let cashBagResult = takeHomeResult = ``;

          for (let i = 0; i < coinNames.length; i++){
            const coinName  = coinNames [i];
            const coinValue = coinValues[i];

            cashBagResult  += `${coinName}: ${cashBag [coinValue]}<br>`;
            takeHomeResult += `${coinName}: ${takeHome[coinValue]}<br>`;
          }

          result += `Going into cash bag: `;
          result += `$${getSum(cashBag).toFixed(2)}<br><br>`;
          result +=  `${cashBagResult}<br>`;

          result += `Taking home: `;
          result += `$${getSum(takeHome).toFixed(2)}<br><br>`;
          result +=  `${takeHomeResult}<br>`;

          if (remaining < 0) result += `You are owed $${-remaining.toFixed(2)}`;
        }
        
        localStorage.setItem("result", result);
      }
    
      function clearInput(){
        for (coinValue in takeHome) takeHome[coinValue] = 0;

        localStorage.setItem("amount", 0);
        localStorage.setItem("result", "");
        localStorage.setItem("input", JSON.stringify(takeHome));
      }
    </script>
  </body>
</html>